<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Topup - Student Cafe</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
  <h3>充值</h3>
  <form id="f" class="mb-3">
    <div class="mb-2">
      <label class="form-label">卡 UID</label>
      <input class="form-control" id="uid" required>
    </div>
    <div class="mb-2">
      <label class="form-label">金额（元）</label>
      <input class="form-control" id="amt" type="number" step="0.01" required>
    </div>
    <div class="mb-2">
      <label class="form-label">方式</label>
      <select class="form-select" id="method">
        <option value="cash">现金</option>
        <option value="qrpay">扫码</option>
      </select>
    </div>
    <button class="btn btn-success">充值</button>
  </form>
  <pre id="out"></pre>
<script>
document.getElementById('f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const payload = {
    uid: document.getElementById('uid').value.trim().toUpperCase(),
    amount_cents: Math.round(parseFloat(document.getElementById('amt').value)*100),
    method: document.getElementById('method').value,
    operator: 'operator-1'
  };
  const r = await fetch('/api/topup', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  document.getElementById('out').textContent = JSON.stringify(await r.json(), null, 2);
});
</script>
</body>
</html>

<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Register - Student Cafe</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
  <h3>注册 / 绑定校园卡 UID</h3>
  <div class="alert alert-info">说明：本系统与学校余额<strong>不互通</strong>。注册即表示同意将您的校园卡 UID 绑定到本小店账户。</div>
  <form id="f" class="mb-3">
    <div class="mb-2">
      <label class="form-label">卡 UID（大写十六进制）</label>
      <input class="form-control" id="uid" placeholder="如：977C497B" required>
    </div>
    <div class="mb-2">
      <label class="form-label">姓名</label>
      <input class="form-control" id="name" required>
    </div>
    <div class="mb-2">
      <label class="form-label">学号（可选）</label>
      <input class="form-control" id="student_id">
    </div>
    <div class="mb-2">
      <label class="form-label">手机号（可选）</label>
      <input class="form-control" id="phone">
    </div>
    <div class="mb-2">
      <label class="form-label">设置4位PIN（可选，建议开启）</label>
      <input class="form-control" id="pin" minlength="4" maxlength="4" type="password">
    </div>
    <button class="btn btn-primary">提交</button>
  </form>
  <pre id="out"></pre>
<script>
document.getElementById('f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const payload = {
    uid: document.getElementById('uid').value.trim().toUpperCase(),
    name: document.getElementById('name').value.trim(),
    student_id: document.getElementById('student_id').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    pin: document.getElementById('pin').value.trim(),
    registered_by: 'operator-1'
  };
  const r = await fetch('/api/register', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  document.getElementById('out').textContent = JSON.stringify(await r.json(), null, 2);
});
</script>
</body>
</html>
